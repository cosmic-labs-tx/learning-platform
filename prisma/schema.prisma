datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id         String  @id @default(cuid())
  email      String  @unique
  firstName  String
  lastName   String
  phone      String?
  isActive   Boolean @default(true)
  isVerified Boolean @default(false)
  stripeId   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  role             UserRole?
  password         Password?
  courses          UserCourses?
  lessonProgresses UserLessonProgress[]
  courseProgresses UserCourseProgress[]
}

model Password {
  hash String

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

model UserRole {
  id Int @id @default(autoincrement())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

// Entities
model Course {
  id           String @id @default(cuid())
  priceInCents Int
  strapiId     Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users              UserCourses[]
  lessons            Lesson[]
  UserCourseProgress UserCourseProgress?
}

model Lesson {
  id                        String @id @default(cuid())
  strapiId                  Int?
  requiredDurationInSeconds Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  course     Course               @relation(fields: [courseId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  courseId   String
  progresses UserLessonProgress[]
}

// Relations
model UserCourses {
  id          Int     @id @default(autoincrement())
  isCompleted Boolean @default(false)

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique

  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  courseId String @unique
}

model UserCourseProgress {
  id          Int     @id @default(autoincrement())
  isCompleted Boolean @default(false)

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique

  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  courseId String @unique

  durationInSeconds Int
}

model UserLessonProgress {
  id          Int     @id @default(autoincrement())
  isCompleted Boolean @default(false)

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique

  lesson   Lesson @relation(fields: [lessonId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  lessonId String @unique

  durationInSeconds Int?
}
